<div class="curl2py-container">
  <div class="curl2py-header">
    <span class="curl2py-badge">curl ➜ Python requests</span>
    <p class="curl2py-subtitle">
      Paste a <code>curl</code> command on the left and get equivalent <code>requests</code> code on the right.
    </p>
  </div>

  <div class="curl2py-options">
    <label class="curl2py-checkbox">
      <input type="checkbox" id="curl2py-use-session" checked="">
      <span>Use <code>requests.Session()</code></span>
    </label>
    <label class="curl2py-checkbox">
      <input type="checkbox" id="curl2py-include-response" checked="">
      <span>Include basic response printing</span>
    </label>
  </div>

  <div class="curl2py-main">
    <div class="curl2py-panel">
      <div class="curl2py-panel-header">
        <div>
          <div class="curl2py-label">cURL command</div>
          <div class="curl2py-help-text">Supports method, headers, body, auth, and common flags.</div>
        </div>
        <div class="curl2py-actions">
          <button type="button" class="curl2py-button curl2py-button-ghost" id="curl2py-example-1">
            Load simple example
          </button>
          <button type="button" class="curl2py-button curl2py-button-ghost" id="curl2py-example-2">
            Load JSON example
          </button>
        </div>
      </div>
      <textarea id="curl2py-input" class="curl2py-textarea" spellcheck="false" placeholder="Example:
curl -X POST &quot;https://api.example.com/items&quot; \
  -H &quot;Authorization: Bearer TOKEN&quot; \
  -H &quot;Content-Type: application/json&quot; \
  --data &quot;{\&quot;name\&quot;:\&quot;Sample\&quot;}&quot;"></textarea>
      <div class="curl2py-panel-footer">
        <button type="button" class="curl2py-button" id="curl2py-convert">
          Convert to Python
        </button>
        <span class="curl2py-status" id="curl2py-status" aria-live="polite"></span>
      </div>
    </div>

    <div class="curl2py-panel curl2py-panel-output">
      <div class="curl2py-panel-header">
        <div class="curl2py-label">Python <code>requests</code> code</div>
        <button type="button" class="curl2py-button curl2py-button-ghost" id="curl2py-copy">
          Copy code
        </button>
      </div>
      <pre class="curl2py-output" id="curl2py-output" tabindex="0"><code># Your Python code will appear here...</code></pre>
      <div class="curl2py-footer-note">
        Generated code is a best-effort translation. Always review before using in production.
      </div>
    </div>
  </div>
</div>

<style>
  .curl2py-container {
    --curl2py-accent: #228fcb;
    --curl2py-bg: #ffffff;
    --curl2py-border: #d5dbe3;
    --curl2py-text: #1f2933;
    --curl2py-muted: #6b7280;
    --curl2py-radius-lg: 12px;
    --curl2py-radius-xl: 16px;
    --curl2py-shadow-soft: 0 10px 30px rgba(15, 23, 42, 0.08);

    max-width: 1040px;
    margin: 1.5rem auto;
    padding: 1.5rem;
    background: linear-gradient(135deg, #f5f9ff, #fdfefe);
    border-radius: var(--curl2py-radius-xl);
    box-shadow: var(--curl2py-shadow-soft);
    box-sizing: border-box;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    color: var(--curl2py-text);
  }

  .curl2py-header {
    margin-bottom: 1.25rem;
  }

  .curl2py-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    padding: 0.15rem 0.6rem;
    border-radius: 999px;
    font-size: 0.75rem;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    color: var(--curl2py-accent);
    border: 1px solid rgba(34, 143, 203, 0.25);
    background: rgba(34, 143, 203, 0.05);
  }

  .curl2py-subtitle {
    margin: 0.45rem 0 0;
    font-size: 0.95rem;
    color: var(--curl2py-muted);
  }

  .curl2py-subtitle code {
    background: rgba(15, 23, 42, 0.04);
    padding: 0.05rem 0.25rem;
    border-radius: 0.25rem;
    font-size: 0.86em;
  }

  .curl2py-options {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem 1.5rem;
    margin-bottom: 1.1rem;
    font-size: 0.85rem;
    color: var(--curl2py-muted);
  }

  .curl2py-checkbox {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    cursor: pointer;
  }

  .curl2py-checkbox input {
    width: 15px;
    height: 15px;
    border-radius: 4px;
    border: 1px solid var(--curl2py-border);
    accent-color: var(--curl2py-accent);
  }

  .curl2py-main {
    display: grid;
    grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
    gap: 1rem;
  }

  .curl2py-panel {
    background: var(--curl2py-bg);
    border-radius: var(--curl2py-radius-lg);
    padding: 0.9rem 0.95rem 0.9rem;
    border: 1px solid var(--curl2py-border);
    display: flex;
    flex-direction: column;
    box-sizing: border-box;
  }

  .curl2py-panel-output {
    border-left: 4px solid var(--curl2py-accent);
  }

  .curl2py-panel-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
    margin-bottom: 0.6rem;
  }

  .curl2py-label {
    font-size: 0.9rem;
    font-weight: 600;
    color: #111827;
  }

  .curl2py-help-text {
    margin-top: 0.1rem;
    font-size: 0.78rem;
    color: var(--curl2py-muted);
  }

  .curl2py-actions {
    display: flex;
    gap: 0.4rem;
    flex-wrap: wrap;
  }

  /* taller textarea */
  .curl2py-textarea {
    width: 100%;
    min-height: 370px; /* was 220px */
    resize: vertical;
    font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-size: 0.83rem;
    padding: 0.6rem 0.7rem;
    border-radius: 8px;
    border: 1px solid var(--curl2py-border);
    box-sizing: border-box;
    background: #f9fafb;
    color: #111827;
    line-height: 1.4;
    outline: none;
  }

  .curl2py-textarea:focus {
    border-color: var(--curl2py-accent);
    box-shadow: 0 0 0 1px rgba(34, 143, 203, 0.2);
    background: #ffffff;
  }

  .curl2py-textarea::placeholder {
    color: #9ca3af;
  }

  .curl2py-panel-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 0.6rem;
    gap: 0.5rem;
  }

  .curl2py-status {
    font-size: 0.78rem;
    color: var(--curl2py-muted);
    min-height: 1em;
  }

  .curl2py-button {
    border: none;
    border-radius: 999px;
    padding: 0.4rem 0.85rem;
    font-size: 0.8rem;
    font-weight: 500;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    background: var(--curl2py-accent);
    color: #ffffff;
    box-shadow: 0 4px 14px rgba(34, 143, 203, 0.35);
    transition:
      background 120ms ease,
      box-shadow 120ms ease,
      transform 80ms ease;
    white-space: nowrap;
  }

  .curl2py-button:hover {
    background: #1973a7;
    box-shadow: 0 6px 18px rgba(34, 143, 203, 0.5);
    transform: translateY(-0.5px);
  }

  .curl2py-button:active {
    transform: translateY(0);
    box-shadow: 0 3px 10px rgba(34, 143, 203, 0.35);
  }

  .curl2py-button-ghost {
    background: rgba(34, 143, 203, 0.06);
    color: var(--curl2py-accent);
    box-shadow: none;
    border: 1px solid rgba(34, 143, 203, 0.22);
  }

  .curl2py-button-ghost:hover {
    background: rgba(34, 143, 203, 0.12);
    box-shadow: none;
  }

  /* taller output */
  .curl2py-output {
    margin: 0;
    margin-top: 0.1rem;
    padding: 0.7rem 0.75rem;
    background: #020617;
    border-radius: 9px;
    color: #e5e7eb;
    font-size: 0.78rem;
    line-height: 1.5;
    overflow-x: auto;
    max-height: 420px; /* was 270px */
    box-sizing: border-box;
  }

  .curl2py-output code {
    font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  }

  .curl2py-footer-note {
    margin-top: 0.4rem;
    font-size: 0.75rem;
    color: var(--curl2py-muted);
  }

  @media (max-width: 800px) {
    .curl2py-container {
      padding: 1.1rem;
      margin: 1rem auto;
    }
    .curl2py-main {
      grid-template-columns: minmax(0, 1fr);
    }
    .curl2py-panel-output {
      margin-top: 0.35rem;
    }
  }

  @media (max-width: 520px) {
    .curl2py-panel-header {
      flex-direction: column;
      align-items: flex-start;
    }
    .curl2py-actions {
      width: 100%;
      justify-content: flex-start;
    }
  }
</style>

<script>
  (function () {
    function $(id) {
      return document.getElementById(id);
    }

    function setStatus(message, isError) {
      const el = $("curl2py-status");
      if (!el) return;
      el.textContent = message || "";
      el.style.color = isError ? "#b91c1c" : "#6b7280";
    }

    function tokenizeCurl(command) {
      const tokens = [];
      let current = "";
      let inSingle = false;
      let inDouble = false;
      let escape = false;

      for (let i = 0; i < command.length; i++) {
        const ch = command[i];

        if (escape) {
          current += ch;
          escape = false;
          continue;
        }

        if (ch === "\\") {
          escape = true;
          continue;
        }

        if (ch === "'" && !inDouble) {
          inSingle = !inSingle;
          continue;
        }

        if (ch === '"' && !inSingle) {
          inDouble = !inDouble;
          continue;
        }

        if (!inSingle && !inDouble && /\s/.test(ch)) {
          if (current.length > 0) {
            tokens.push(current);
            current = "";
          }
          continue;
        }

        current += ch;
      }

      if (current.length > 0) {
        tokens.push(current);
      }

      return tokens;
    }

    function parseCurl(command) {
      const tokens = tokenizeCurl(command.trim());

      const result = {
        url: "",
        method: "",
        headers: {},
        dataParts: [],
        isJson: false,
        isForm: false,
        auth: null,
        insecure: false,
      };

      if (!tokens.length) {
        throw new Error("Empty command");
      }

      let i = 0;
      if (tokens[0].toLowerCase() === "curl") {
        i = 1;
      }

      for (; i < tokens.length; i++) {
        const tok = tokens[i];

        if (!tok) continue;

        if (tok === "-X" || tok === "--request") {
          if (i + 1 < tokens.length) {
            result.method = tokens[++i].toUpperCase();
          }
          continue;
        }

        if (tok === "-H" || tok === "--header") {
          if (i + 1 < tokens.length) {
            const header = tokens[++i];
            const idx = header.indexOf(":");
            if (idx !== -1) {
              const name = header.slice(0, idx).trim();
              const value = header.slice(idx + 1).trim();
              if (name) {
                result.headers[name] = value;
                const lowerName = name.toLowerCase();
                if (lowerName === "content-type" && value.toLowerCase().includes("application/json")) {
                  result.isJson = true;
                }
              }
            }
          }
          continue;
        }

        if (
          tok === "-d" ||
          tok === "--data" ||
          tok === "--data-raw" ||
          tok === "--data-binary" ||
          tok === "--data-urlencode"
        ) {
          if (i + 1 < tokens.length) {
            const dataVal = tokens[++i];
            result.dataParts.push(dataVal);
            if (!result.method) result.method = "POST";

            const trimmed = dataVal.trim();
            if (
              trimmed.startsWith("{") ||
              trimmed.startsWith("[") ||
              trimmed.toLowerCase().startsWith("json=")
            ) {
              result.isJson = true;
            }
          }
          continue;
        }

        if (tok === "--json") {
          if (i + 1 < tokens.length) {
            const jsonVal = tokens[++i];
            result.dataParts.push(jsonVal);
            result.isJson = true;
            if (!result.method) result.method = "POST";
          }
          continue;
        }

        if (tok === "--url") {
          if (i + 1 < tokens.length) {
            result.url = tokens[++i];
          }
          continue;
        }

        if (tok === "-u" || tok === "--user") {
          if (i + 1 < tokens.length) {
            const creds = tokens[++i];
            const parts = creds.split(":");
            result.auth = {
              user: parts[0] || "",
              pass: parts.slice(1).join(":") || "",
            };
          }
          continue;
        }

        if (tok === "-F" || tok === "--form") {
          if (i + 1 < tokens.length) {
            const formPart = tokens[++i];
            result.dataParts.push(formPart);
            result.isForm = true;
            if (!result.method) result.method = "POST";
          }
          continue;
        }

        if (tok === "--insecure" || tok === "-k") {
          result.insecure = true;
          continue;
        }

        if (tok === "--compressed") {
          continue;
        }

        if (tok.startsWith("-")) {
          continue;
        }

        if (!result.url) {
          result.url = tok;
        }
      }

      if (!result.url) {
        throw new Error("Could not find a URL in the curl command.");
      }

      if (!result.method) {
        result.method = result.dataParts.length ? "POST" : "GET";
      }

      return result;
    }

    // Option B JSON handling: try to parse JSON-like bodies safely
    function generatePython(parsed, options) {
      const lines = [];
      lines.push("# Generated by curl → Python requests converter");
      lines.push("import requests");

      const useSession = !!options.useSession;
      const includeResponse = !!options.includeResponse;

      const headerKeys = Object.keys(parsed.headers);
      const hasData = parsed.dataParts.length > 0;

      let rawDataCombined = null;
      let attemptedJsonParse = false;
      let jsonParsedOK = false;
      let needsJsonImport = false;

      if (hasData) {
        rawDataCombined = parsed.dataParts.join("&");
        const trimmed = rawDataCombined.trim();
        if (parsed.isJson || trimmed.startsWith("{") || trimmed.startsWith("[")) {
          attemptedJsonParse = true;
          try {
            JSON.parse(rawDataCombined);
            jsonParsedOK = true;
            needsJsonImport = true;
          } catch (e) {
            jsonParsedOK = false;
          }
        }
      }

      if (needsJsonImport) {
        lines.push("import json");
      }

      lines.push("");
      lines.push(`url = ${JSON.stringify(parsed.url)}`);

      if (headerKeys.length) {
        lines.push("");
        lines.push("headers = {");
        headerKeys.forEach(function (name) {
          const value = parsed.headers[name];
          const keyLiteral = JSON.stringify(name);
          const valLiteral = JSON.stringify(value);
          lines.push(`    ${keyLiteral}: ${valLiteral},`);
        });
        lines.push("}");
      }

      let dataVar = null;
      let useJsonParam = false;

      if (hasData) {
        if (jsonParsedOK) {
          dataVar = "json_data";
          useJsonParam = true;
          lines.push("");
          // Pass string into json.loads so Python gets a dict/list
          lines.push(`json_data = json.loads(${JSON.stringify(rawDataCombined)})`);
        } else if (parsed.isForm) {
          dataVar = "form_data";
          lines.push("");
          lines.push(`form_data = ${JSON.stringify(rawDataCombined)}`);
          lines.push("# NOTE: This came from multipart/form-data (-F).");
          lines.push("#       You may want to convert this into a 'files' or 'data' dict.");
        } else {
          dataVar = "data";
          lines.push("");
          lines.push(`data = ${JSON.stringify(rawDataCombined)}`);
          if (attemptedJsonParse) {
            lines.push("# NOTE: Body looked like JSON but could not be parsed. Adjust as needed.");
          }
        }
      }

      let hasAuth = !!parsed.auth;
      if (hasAuth) {
        lines.push("");
        lines.push(
          `auth = (${JSON.stringify(parsed.auth.user)}, ${JSON.stringify(parsed.auth.pass)})`
        );
      }

      if (useSession) {
        lines.push("");
        lines.push("session = requests.Session()");
      }

      lines.push("");
      const methodLiteral = JSON.stringify(parsed.method.toUpperCase());

      let callLine = useSession ? "response = session.request(" : "response = requests.request(";
      callLine += `${methodLiteral}, url`;

      const kwParts = [];
      if (headerKeys.length) {
        kwParts.push("headers=headers");
      }
      if (hasData && dataVar) {
        if (useJsonParam) {
          kwParts.push(`json=${dataVar}`);
        } else {
          kwParts.push(`data=${dataVar}`);
        }
      }
      if (hasAuth) {
        kwParts.push("auth=auth");
      }
      if (parsed.insecure) {
        kwParts.push("verify=False");
      }

      if (kwParts.length) {
        callLine += ", " + kwParts.join(", ");
      }
      callLine += ")";
      lines.push(callLine);

      if (parsed.insecure) {
        lines.push("# WARNING: 'verify=False' skips SSL certificate verification. Use with caution.");
      }

      if (includeResponse) {
        lines.push("");
        lines.push("print(response.status_code)");
        lines.push("print(response.text)");
      }

      return lines.join("\n");
    }

    function convert() {
      const raw = $("curl2py-input").value || "";
      const trimmed = raw.trim();

      if (!trimmed) {
        setStatus("Please paste a curl command to convert.", true);
        $("curl2py-output").textContent = "# Your Python code will appear here...";
        return;
      }

      try {
        const parsed = parseCurl(trimmed);
        const options = {
          useSession: $("curl2py-use-session").checked,
          includeResponse: $("curl2py-include-response").checked,
        };
        const python = generatePython(parsed, options);
        $("curl2py-output").textContent = python;
        setStatus("Converted successfully. Review and adjust as needed.", false);
      } catch (err) {
        $("curl2py-output").textContent =
          "# Error: " + (err && err.message ? err.message : "Unable to parse command.");
        setStatus(err && err.message ? err.message : "Failed to parse curl command.", true);
      }
    }

    function copyOutput() {
      const outputEl = $("curl2py-output");
      if (!outputEl) return;

      const text = outputEl.textContent || "";
      if (!text.trim()) {
        setStatus("Nothing to copy yet.", true);
        return;
      }

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard
          .writeText(text)
          .then(function () {
            setStatus("Python code copied to clipboard.", false);
          })
          .catch(function () {
            setStatus("Unable to copy automatically. Please select and copy manually.", true);
          });
      } else {
        const range = document.createRange();
        range.selectNodeContents(outputEl);
        const sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);
        setStatus("Selection ready – press Ctrl+C / Cmd+C to copy.", false);
      }
    }

    function loadExample(which) {
      const simpleExample = [
        'curl "https://api.example.com/items?limit=10" \\',
        '  -H "Authorization: Bearer YOUR_TOKEN" \\',
        '  -H "Accept: application/json"',
      ].join("\n");

      const jsonExample = [
        'curl -X POST "https://api.example.com/items" \\',
        '  -H "Authorization: Bearer YOUR_TOKEN" \\',
        '  -H "Content-Type: application/json" \\',
        '  --data "{\\"name\\":\\"Sample item\\",\\"price\\":12.5}"',
      ].join("\n");

      $("curl2py-input").value = which === 1 ? simpleExample : jsonExample;
      setStatus("Example loaded. Click “Convert to Python”.", false);
      $("curl2py-input").focus();
    }

    function autoConvertOnChange() {
      const val = $("curl2py-input").value;
      if (!val.trim()) {
        $("curl2py-output").textContent = "# Your Python code will appear here...";
        setStatus("", false);
        return;
      }
      convert();
    }

    document.addEventListener("DOMContentLoaded", function () {
      const convertBtn = $("curl2py-convert");
      const copyBtn = $("curl2py-copy");
      const input = $("curl2py-input");
      const ex1 = $("curl2py-example-1");
      const ex2 = $("curl2py-example-2");

      if (convertBtn) convertBtn.addEventListener("click", convert);
      if (copyBtn) copyBtn.addEventListener("click", copyOutput);
      if (ex1) ex1.addEventListener("click", function () { loadExample(1); });
      if (ex2) ex2.addEventListener("click", function () { loadExample(2); });

      if (input) {
        let typingTimer = null;
        input.addEventListener("input", function () {
          clearTimeout(typingTimer);
          typingTimer = setTimeout(autoConvertOnChange, 600);
        });
      }

      setStatus("", false);
    });
  })();
</script>
